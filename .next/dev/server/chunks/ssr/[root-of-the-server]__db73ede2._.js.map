{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/PD%20-%20255%20SSD/Cio/Proyectos/Internos/Apps/finanzas-pro/utils/supabase/client.ts"],"sourcesContent":["import { createBrowserClient } from '@supabase/ssr'\n\nexport function createClient() {\n    return createBrowserClient(\n        process.env.NEXT_PUBLIC_SUPABASE_URL!,\n        process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\n    )\n}\n"],"names":[],"mappings":";;;;AAAA;AAAA;;AAEO,SAAS;IACZ,OAAO,IAAA,iMAAmB;AAI9B"}},
    {"offset": {"line": 42, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/PD%20-%20255%20SSD/Cio/Proyectos/Internos/Apps/finanzas-pro/context/FinanceContext.tsx"],"sourcesContent":["\n\"use client\";\n\nimport React, { createContext, useContext, useState, useEffect, ReactNode, useCallback, useMemo } from 'react';\nimport { createClient } from '../utils/supabase/client';\nimport { Transaction, Account, Budget, Commitment, RecurringRule, Ledger, TransactionType, Category, CategoryFolder, UserProfile, Notification } from '../types';\nimport { useRouter } from 'next/navigation';\nimport { addMonths, addWeeks, addYears, isAfter, isBefore, startOfDay, addDays, isSameDay, endOfMonth, subMonths, format, subDays, endOfDay, parseISO, startOfMonth, isWithinInterval } from 'date-fns';\n\n\n// Database types mapping could be strictly done here, but for now we map manually\n// to match the specific \"Ledger\" vs \"Book\" terminology change requested by user logic vs DB logic.\n// The user \"Ledger\" in UI maps to \"Book\" in DB.\n\ninterface FinanceContextType {\n  transactions: Transaction[];\n  accounts: Account[];\n  categories: Category[];\n  categoryFolders: CategoryFolder[];\n  budgets: Budget[];\n  commitments: Commitment[];\n  recurringRules: RecurringRule[];\n  ledgers: Ledger[];\n  userProfile: UserProfile | null;\n  fetchUserProfile: () => Promise<void>;\n  updateUserProfile: (updates: Partial<UserProfile>) => Promise<void>;\n  updatePassword: (current: string, newPass: string) => Promise<boolean>;\n  resetPasswordForEmail: (email: string) => Promise<boolean>;\n  deleteUserAccount: () => Promise<void>;\n  uploadAvatar: (file: File) => Promise<string | null>;\n\n  // Actions\n  addTransaction: (t: Omit<Transaction, 'id'>) => Promise<void>;\n  deleteTransaction: (id: string) => Promise<void>;\n  addAccount: (a: Omit<Account, 'id'>) => Promise<void>;\n  updateAccount: (id: string, a: Partial<Account>) => Promise<void>;\n  deleteAccount: (id: string) => Promise<void>;\n  addCommitment: (c: Omit<Commitment, 'id'>) => Promise<void>;\n  updateCommitment: (id: string, updates: Partial<Commitment>) => Promise<void>;\n  deleteCommitment: (id: string) => Promise<void>;\n  toggleCommitmentStatus: (id: string, currentStatus: string) => Promise<void>;\n  toggleRuleStatus: (id: string) => void;\n  updateTransaction: (id: string, updates: Partial<Transaction>) => Promise<void>;\n  duplicateTransaction: (id: string) => Promise<void>;\n  activateLedger: (id: string) => void;\n  generateSampleData: () => Promise<void>;\n\n  totalBalance: number;\n  isDarkMode: boolean;\n  toggleTheme: () => void;\n  isLoading: boolean;\n  activeBookId: string | null;\n  refreshBooks: () => Promise<void>;\n  formatAmount: (amount: number) => string;\n  isTransactionModalOpen: boolean;\n  openTransactionModal: () => void;\n  closeTransactionModal: () => void;\n  addBudget: (b: { amount: number; categoryId: string; recurrenceType?: string; recurrenceInterval?: number; startDate?: string; endDate?: string }) => Promise<void>;\n  updateBudget: (id: string, updates: Partial<{ amount: number; categoryId: string; recurrenceType?: string; recurrenceInterval?: number; startDate?: string; endDate?: string }>) => Promise<void>;\n  deleteBudget: (id: string) => Promise<void>;\n  checkRecurringBudgets: () => Promise<void>;\n  deleteCategory: (id: string) => Promise<void>;\n  deleteCategoryFolder: (id: string) => Promise<void>;\n  notifications: Notification[];\n  unreadCount: number;\n  markNotificationAsRead: (id: string) => void;\n  markAllNotificationsAsRead: () => void;\n}\n\nconst FinanceContext = createContext<FinanceContextType | undefined>(undefined);\n\nexport const FinanceProvider: React.FC<{ children: ReactNode }> = ({ children }) => {\n  const supabase = createClient();\n  const router = useRouter();\n\n  // State\n  const [activeBookId, setActiveBookId] = useState<string | null>(null);\n  const [transactions, setTransactions] = useState<Transaction[]>([]);\n  const [accounts, setAccounts] = useState<Account[]>([]);\n  const [categories, setCategories] = useState<Category[]>([]);\n  const [categoryFolders, setCategoryFolders] = useState<CategoryFolder[]>([]);\n  const [budgets, setBudgets] = useState<Budget[]>([]);\n  const [commitments, setCommitments] = useState<Commitment[]>([]);\n  const [recurringRules, setRecurringRules] = useState<RecurringRule[]>([]); // Migration TODO: Link to commitments?\n  const [ledgers, setLedgers] = useState<Ledger[]>([]); // These are 'books' now\n  const [userProfile, setUserProfile] = useState<UserProfile | null>(null);\n  const [notifications, setNotifications] = useState<Notification[]>([]);\n\n\n  const [isLoading, setIsLoading] = useState(true);\n  const [isDarkMode, setIsDarkMode] = useState(false);\n\n  // Theme Logic\n  const toggleTheme = useCallback(() => {\n    setIsDarkMode(prev => {\n      const newMode = !prev;\n      if (typeof window !== 'undefined') {\n        const root = window.document.documentElement;\n        if (newMode) root.classList.add('dark');\n        else root.classList.remove('dark');\n      }\n      return newMode;\n    });\n  }, []);\n\n  const fetchBooks = useCallback(async () => {\n    setIsLoading(true);\n    const { data: { user } } = await supabase.auth.getUser();\n\n    if (!user) {\n      setIsLoading(false);\n      return;\n    }\n\n    const { data: books, error } = await supabase.from('books').select('*');\n\n    if (error) {\n      console.error(\"Error fetching books:\", error);\n      console.error(\"Supabase URL present?\", !!process.env.NEXT_PUBLIC_SUPABASE_URL);\n      console.error(\"Supabase Key present?\", !!process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY);\n    }\n\n    if (books && books.length > 0) {\n      const mappedLedgers: Ledger[] = books.map(b => ({\n        id: b.id,\n        name: b.name,\n        description: b.short_description || '',\n        balance: 0,\n        isActive: false,\n        isArchived: false,\n        lastUpdate: b.created_at,\n        icon: b.icon || 'Wallet',\n        color: b.color || 'blue', // Default\n        type: 'PERSONAL',\n        members: [],\n        currency: b.currency\n      }));\n\n      setLedgers(mappedLedgers);\n\n      // Initial activation logic can be here or in useEffect\n      // We will activate first if none active in useEffect or consumer\n    } else {\n      await createDefaultBook(user.id);\n    }\n    setIsLoading(false);\n  }, [supabase]);\n\n  // Check for Credit Card Commitments\n  const checkCreditCardCommitments = useCallback(async () => {\n    if (accounts.length === 0 || transactions.length === 0 || isLoading) return;\n\n    for (const account of accounts) {\n      if (account.type !== 'CREDIT' || !account.cutoffDay || !account.payDay) continue;\n\n      const today = new Date();\n      // Determine the latest CLOSED cutoff date\n      let cycleCutoff = new Date(today.getFullYear(), today.getMonth(), account.cutoffDay);\n\n      // If today is before or equal to this month's cutoff, the last closed cycle was LAST month.\n      if (today.getDate() <= account.cutoffDay) {\n        cycleCutoff = subMonths(cycleCutoff, 1);\n      }\n\n      // Identify this cycle uniquely\n      const periodLabel = format(cycleCutoff, 'MMM yyyy');\n      const commitmentName = `Pago Tarjeta ${account.name} - ${periodLabel}`;\n\n      // Find appropriate category (reused logic)\n      let paymentCategoryid = categories.find(c => ['pagos', 'tarjeta', 'tarjetas', 'credit', 'payment', 'finance', 'finanzas'].some(key => c.name.toLowerCase().includes(key)))?.id;\n      if (!paymentCategoryid) paymentCategoryid = categories.find(c => c.name === 'General')?.id;\n      if (!paymentCategoryid && categories.length > 0) {\n        paymentCategoryid = categories[0].id;\n      }\n\n      // Find Funding Account (Debit with money, or any Debit)\n      const fundingAccount = accounts.find(a => a.type === 'DEBIT' && a.balance > 0) || accounts.find(a => a.type === 'DEBIT');\n\n      // Deduplicate first\n      const matches = commitments.filter(c => c.name === commitmentName && c.accountId === account.id);\n      if (matches.length > 1) {\n        // Identify the best one to keep (e.g., the one with funding account or correct type)\n        const valid = matches.find(c => c.transaction_type === 'INCOME' && c.fundingAccountId)\n          || matches.find(c => c.transaction_type === 'INCOME')\n          || matches[0];\n\n        const others = matches.filter(c => c.id !== valid.id);\n        for (const other of others) {\n          console.log(`Removing duplicate commitment: ${other.id}`);\n          await deleteCommitment(other.id);\n        }\n        // After delete, we continue with the 'valid' one as existing\n      }\n\n      // Check if commitment exists and needs update (Refresh find after dedupe)\n      const existingCommitment = commitments.find(c => c.name === commitmentName && c.accountId === account.id);\n\n      if (existingCommitment) {\n        // Check if needs fix (wrong type or missing category or funding account)\n        if (existingCommitment.transaction_type !== 'INCOME' || !existingCommitment.categoryId || !existingCommitment.fundingAccountId) {\n          console.log(`Fixing existing commitment: ${existingCommitment.name}`);\n          await updateCommitment(existingCommitment.id, {\n            transaction_type: 'INCOME',\n            categoryId: paymentCategoryid,\n            fundingAccountId: fundingAccount?.id\n          });\n        }\n        continue;\n      }\n\n      // Calculate Cycle Expenses\n      // Cycle starts day after PREVIOUS cutoff.\n      const prevCutoff = subMonths(cycleCutoff, 1);\n      const startOfCycle = startOfDay(addDays(prevCutoff, 1));\n      const endOfCycle = endOfDay(cycleCutoff);\n\n      const cycleExpenses = transactions.reduce((sum, t) => {\n        if ((t.account === account.name || t.account_id === account.id) &&\n          t.type === 'EXPENSE') {\n          const tDate = new Date(t.date);\n          if (tDate >= startOfCycle && tDate <= endOfCycle) {\n            return sum + t.amount;\n          }\n        }\n        return sum;\n      }, 0);\n\n      if (cycleExpenses <= 0) continue;\n\n      // Calculate Due Date (Pay Day - 1 Day)\n      let payDate = new Date(cycleCutoff.getFullYear(), cycleCutoff.getMonth(), account.payDay);\n      // If payDate is before cutoff (unlikely but possible if payday < cutoff), move to next month.\n      // E.g. Cutoff 18th, Payday 10th. Jan 18 close -> Due Feb 10.\n      if (account.payDay <= account.cutoffDay) {\n        payDate = addMonths(payDate, 1);\n      } else {\n        // Payday 28th. Jan 18 close -> Due Jan 28.\n        // Already in same month as cycleCutoff.\n      }\n\n      const limitDate = subDays(payDate, 1);\n\n      // Create Commitment (Category finding moved up)\n      await addCommitment({\n        name: commitmentName,\n        amount: cycleExpenses,\n        frequency: 'MONTHLY',\n        type: 'TEMPORAL',\n        nextDueDate: limitDate.toISOString(),\n        status: 'PENDING',\n        isActive: true,\n        accountId: account.id,\n        categoryId: paymentCategoryid, // Assign the found category\n        transaction_type: 'INCOME', // Paying the credit card is an INCOME to the credit card account\n        fundingAccountId: fundingAccount?.id, // Default funding source\n        account: account.name\n      });\n\n      console.log(`Generated commitment for ${account.name}: ${cycleExpenses} due ${limitDate.toISOString()}`);\n    }\n  }, [accounts, transactions, isLoading, categories, commitments]); // Dependencies updated\n\n  // Deduplicate logic helper\n  const deduplicateCommitments = useCallback(async (account: Account, periodLabel: string) => {\n    const commitmentName = `Pago Tarjeta ${account.name} - ${periodLabel}`;\n    // Find ALL matching commitments\n    const matches = commitments.filter(c => c.name === commitmentName && c.accountId === account.id);\n\n    if (matches.length > 1) {\n      console.warn(`Found ${matches.length} duplicates for ${commitmentName}. Keeping the one with manual edits or the last one.`);\n      // Sort by updated_at? We don't have it on type easily, assumed standard sort.\n      // Keep the one with fundingAccountId if exists, or just the first/last.\n      // Let's keep the one with ID that matches a 'valid' criteria or just the first one and delete others.\n      const keep = matches.find(c => c.fundingAccountId) || matches[0];\n      const toDelete = matches.filter(c => c.id !== keep.id);\n\n      for (const c of toDelete) {\n        await deleteCommitment(c.id);\n      }\n    }\n  }, [commitments]);\n\n  useEffect(() => {\n    // Ensure commitments are loaded or at least we have tried to fetch them.\n    // We can check if commitments array is populated or if we have a flag.\n    // Relying on accounts/transactions implies data is loaded.\n    // Adding `commitments` to deps ensures we re-run if they change (e.g. initial load finish).\n    // But we must guard against infinite loop if this function *modifies* commitments.\n    // checkCreditCardCommitments modifies commitments ONLY if needed.\n    if (!isLoading && accounts.length > 0 && transactions.length > 0) {\n      checkCreditCardCommitments();\n      generateNotifications();\n    }\n  }, [isLoading, accounts, transactions.length, commitments.length, budgets.length]); // Added dependencies\n\n  // Notification Logic\n  const generateNotifications = useCallback(() => {\n    const newNotifications: Notification[] = [];\n    const today = new Date();\n\n    // 1. Commitments Due Soon (3 days)\n    commitments.forEach(c => {\n      if (c.status === 'PENDING' && c.isActive) {\n        const dueDate = parseISO(c.nextDueDate);\n        if (isBefore(dueDate, addDays(today, 3)) && isAfter(dueDate, subDays(today, 1))) {\n          newNotifications.push({\n            id: `comm-${c.id}`,\n            title: 'Pago Próximo',\n            message: `El compromiso \"${c.name}\" vence el ${format(dueDate, 'dd MMM')}.`,\n            time: format(today, 'HH:mm'), // approximated\n            type: 'WARNING',\n            read: false\n          });\n        }\n      }\n    });\n\n    // 2. Budgets (Approximate for Current Month)\n    // We recreate simplistic logic here: Filter transactions for current month & category\n    const startMonth = startOfMonth(today);\n    const endMonth = endOfMonth(today);\n\n    budgets.forEach(b => {\n      const categoryId = b.category_id;\n      if (!categoryId) return; // Skip if no ID\n\n      // Calculate spent for this budget's category in current month\n      const spent = transactions\n        .filter(t =>\n          t.type === 'EXPENSE' &&\n          t.category_id === categoryId &&\n          isWithinInterval(new Date(t.date), { start: startMonth, end: endMonth })\n        )\n        .reduce((sum, t) => sum + t.amount, 0);\n\n      const ratio = b.limit > 0 ? spent / b.limit : 0;\n\n      if (ratio >= 1) {\n        newNotifications.push({\n          id: `bud-err-${b.id}`,\n          title: 'Presupuesto Excedido',\n          message: `Has excedido tu presupuesto de ${b.category || 'Categoría'}.`,\n          time: 'Ahora',\n          type: 'ERROR',\n          read: false\n        });\n      } else if (ratio >= 0.8) {\n        newNotifications.push({\n          id: `bud-warn-${b.id}`,\n          title: 'Presupuesto al Límite',\n          message: `Estás al ${(ratio * 100).toFixed(0)}% de tu presupuesto de ${b.category || 'Categoría'}.`,\n          time: 'Ahora',\n          type: 'WARNING',\n          read: false\n        });\n      }\n    });\n\n    // 3. Credit Cards Pay Day (3 days)\n    accounts.filter(a => a.type === 'CREDIT').forEach(acc => {\n      if (acc.payDay) {\n        // Calculate next pay date (naive approach: this month's pay day)\n        let payDate = new Date(today.getFullYear(), today.getMonth(), acc.payDay);\n        if (isBefore(payDate, today)) {\n          payDate = addMonths(payDate, 1);\n        }\n\n        if (isWithinInterval(payDate, { start: today, end: addDays(today, 3) })) {\n          newNotifications.push({\n            id: `cc-${acc.id}`,\n            title: 'Tarjeta de Crédito',\n            message: `La fecha de pago de ${acc.name} es el ${format(payDate, 'dd MMM')}.`,\n            time: 'Ahora',\n            type: 'INFO',\n            read: false\n          });\n        }\n      }\n    });\n\n    // Deduplicate or Merge with existing read status?\n    // For MVP, we replace, but we lose \"read\" status if we just replace.\n    // Ideally we persist read status in local storage or DB. \n    // Let's implement a simple LocalStorage check for \"read ids\".\n    const readIds = JSON.parse(localStorage.getItem('read_notifications') || '[]');\n\n    const finalNotifications = newNotifications.map(n => ({\n      ...n,\n      read: readIds.includes(n.id)\n    }));\n\n    // Sort?\n    setNotifications(finalNotifications);\n  }, [commitments, budgets, transactions, accounts]);\n\n  const markNotificationAsRead = useCallback((id: string) => {\n    setNotifications(prev => prev.map(n => n.id === id ? { ...n, read: true } : n));\n    const readIds = JSON.parse(localStorage.getItem('read_notifications') || '[]');\n    if (!readIds.includes(id)) {\n      readIds.push(id);\n      localStorage.setItem('read_notifications', JSON.stringify(readIds));\n    }\n  }, []);\n\n  const markAllNotificationsAsRead = useCallback(() => {\n    setNotifications(prev => prev.map(n => ({ ...n, read: true })));\n    const allIds = notifications.map(n => n.id);\n    const readIds = JSON.parse(localStorage.getItem('read_notifications') || '[]');\n    const newReadIds = Array.from(new Set([...readIds, ...allIds]));\n    localStorage.setItem('read_notifications', JSON.stringify(newReadIds));\n  }, [notifications]);\n\n  const unreadCount = notifications.filter(n => !n.read).length;\n\n\n  // Initial Load\n  useEffect(() => {\n    fetchBooks().then((mappedLedgers) => {\n      // Logic moved inside to have access to the fetched ledgers directly if returned, \n      // or we rely on state updates which might be async.\n      // Better approach: fetchBooks updates state. We wait for that.\n    });\n  }, []);\n\n  // Effect to handle initial active book selection once ledgers are loaded\n  useEffect(() => {\n    if (!isLoading && ledgers.length > 0 && !activeBookId) {\n      // Try to recover from localStorage\n      const savedBookId = localStorage.getItem('finance_active_book_id');\n      const targetBook = ledgers.find(l => l.id === savedBookId);\n\n      if (targetBook) {\n        handleChangeActiveBook(targetBook.id);\n      } else {\n        // Default to first if no saved book or saved book not found/deleted\n        handleChangeActiveBook(ledgers[0].id);\n      }\n    }\n  }, [isLoading, ledgers, activeBookId]);\n\n  // Helper to format currency based on active book\n  const formatAmount = useCallback((amount: number) => {\n    const activeLedger = ledgers.find(l => l.id === activeBookId);\n    const currency = activeLedger?.currency || 'MXN';\n\n    let locale = 'es-MX';\n    if (currency === 'USD') locale = 'en-US';\n    if (currency === 'EUR') locale = 'es-ES';\n    if (currency === 'PEN') return `S/ ${amount.toLocaleString('es-PE', { minimumFractionDigits: 2 })}`;\n    if (currency === 'COP') locale = 'es-CO';\n\n    return new Intl.NumberFormat(locale, {\n      style: 'currency',\n      currency: currency,\n      minimumFractionDigits: 2,\n    }).format(amount);\n  }, [ledgers, activeBookId]);\n\n  const fetchCategories = useCallback(async (bookId: string) => {\n    const { data } = await supabase.from('categories').select('*').eq('book_id', bookId);\n    if (data) {\n      setCategories(data.map((cat: any) => ({\n        id: cat.id,\n        name: cat.name,\n        color: cat.color || '#2563eb',\n        icon: cat.icon || 'category',\n        folder_id: cat.folder_id || null\n      })));\n    }\n  }, [supabase]);\n\n  const fetchCategoryFolders = useCallback(async (bookId: string) => {\n    const { data } = await supabase.from('category_folders').select('*').eq('book_id', bookId);\n    if (data) {\n      setCategoryFolders(data.map((folder: any) => ({\n        id: folder.id,\n        name: folder.name,\n        color: folder.color || '#6366f1',\n        icon: folder.icon || 'folder'\n      })));\n    }\n  }, [supabase]);\n\n  const fetchAccounts = useCallback(async (bookId: string) => {\n    const { data } = await supabase.from('accounts').select('*').eq('book_id', bookId);\n    if (data) {\n      setAccounts(data.map(a => ({\n        ...a,\n        // Ensure types match UI expectation and map snake_case to camelCase\n        type: a.type as any,\n        creditLimit: a.credit_limit,\n        availableCredit: a.available_credit,\n        cutoffDay: a.cutoff_day,\n        payDay: a.pay_day,\n        lastFour: a.last_four,\n        autoPay: a.auto_pay,\n        isDefault: a.is_default,\n        cardholderName: a.cardholder_name,\n        expiryDate: a.expiry_date,\n        // Keep original if needed, but UI uses camelCase\n      })));\n    }\n  }, [supabase]);\n\n  const fetchTransactions = useCallback(async (bookId: string) => {\n    const { data } = await supabase\n      .from('transactions')\n      .select(`\n        *,\n        categories (name, icon, color),\n        accounts (name)\n      `)\n      .eq('book_id', bookId)\n      .order('occurred_at', { ascending: false });\n\n    if (data) {\n      setTransactions(data.map((t: any) => ({\n        id: t.id,\n        amount: t.amount,\n        type: t.type as any,\n        category: t.categories?.name || 'Uncategorized',\n        category_id: t.category_id,\n        account: t.accounts?.name || 'Unknown',\n        account_id: t.account_id,\n        description: t.description || '',\n        date: t.occurred_at,\n        icon: t.categories?.icon || 'attach_money',\n        status: t.status as any,\n        location: t.location_text, // Map DB location_text to UI location\n        notes: t.notes,\n        beneficiary: t.beneficiary,\n        created_at: t.created_at,\n        updated_at: t.updated_at\n      })));\n    }\n  }, [supabase]);\n\n  const fetchCommitments = useCallback(async (bookId: string) => {\n    const { data, error } = await supabase\n      .from('commitments')\n      .select(`\n        *,\n        categories (name),\n        accounts:account_id (name)\n      `)\n      .eq('book_id', bookId);\n\n    if (error) {\n      console.error('Error fetching commitments:', error);\n    }\n\n    if (data) {\n      setCommitments(data.map((c: any) => ({\n        id: c.id,\n        name: c.title,\n        amount: c.amount,\n        frequency: c.frequency as any,\n        nextDueDate: c.next_due_date,\n        status: c.status as any,\n        type: c.type as any || 'FIXED',\n        isActive: c.is_active ?? true,\n        endDate: c.end_date,\n        category: c.categories?.name || 'General',\n        account: c.accounts?.name || 'Cuenta principal',\n        categoryId: c.category_id,\n        accountId: c.account_id,\n        recurrence: c.recurrence,\n        transaction_type: c.transaction_type,\n        isAutoPay: c.is_auto_pay,\n        fundingAccountId: c.funding_account_id\n      })));\n    }\n  }, [supabase]);\n\n  const fetchBudgets = useCallback(async (bookId: string) => {\n    // Joining handled client-side in UI to ensure robustness\n    const { data, error } = await supabase\n      .from('budgets')\n      .select('*')\n      .eq('book_id', bookId);\n\n    if (error) {\n      console.warn('Error loading budgets', error.message);\n      return;\n    }\n    if (data) {\n      setBudgets(data.map((b: any) => ({\n        id: b.id,\n        category: 'Loading...', // Main mapping done in Page via category_id\n        category_id: b.category_id,\n        limit: Number(b.amount || 0),\n        spent: 0,\n        period: 'MONTHLY',\n        severity: 'NORMAL',\n        start_date: b.start_date,\n        end_date: b.end_date,\n        recurrence_type: b.recurrence_type,\n        recurrence_interval: b.recurrence_interval,\n        created_at: b.created_at\n      })));\n    }\n  }, [supabase]);\n\n  const fetchRecurringRules = useCallback(async (bookId: string) => {\n    const { data, error } = await supabase\n      .from('recurring_rules')\n      .select(`\n        *,\n        categories (name, icon, color),\n        accounts (name)\n      `)\n      .eq('book_id', bookId);\n\n    if (error) {\n      console.warn('No fue posible cargar reglas recurrentes', error.message);\n      return;\n    }\n    if (data) {\n      setRecurringRules(data.map((r: any) => ({\n        id: r.id,\n        name: r.name,\n        category: r.categories?.name || 'General',\n        account: r.accounts?.name || 'Cuenta principal',\n        amount: Number(r.amount ?? 0),\n        type: (r.type as TransactionType) || 'EXPENSE',\n        frequency: r.frequency || 'Mensual',\n        nextDate: r.next_run_at || '',\n        active: r.is_active ?? true,\n        icon: r.categories?.icon || 'autorenew'\n      })));\n    }\n  }, [supabase]);\n\n  const refreshBooks = useCallback(async () => {\n    await fetchBooks();\n    if (activeBookId) {\n      await Promise.all([\n        fetchAccounts(activeBookId),\n        fetchCategories(activeBookId),\n        fetchCategoryFolders(activeBookId),\n        fetchTransactions(activeBookId),\n        fetchCommitments(activeBookId),\n        fetchBudgets(activeBookId),\n        fetchRecurringRules(activeBookId)\n      ]);\n    }\n  }, [activeBookId, fetchBooks]);\n\n  const createDefaultBook = useCallback(async (userId: string) => {\n    const { data, error } = await supabase.from('books').insert({\n      name: 'Personal',\n      user_id: userId\n    }).select().single();\n\n    if (error) {\n      console.error(\"Error creating default book:\", error);\n    }\n\n    if (data) {\n      const newLedger: Ledger = {\n        id: data.id,\n        name: data.name,\n        description: 'Mi primer libro contable',\n        balance: 0,\n        isActive: true,\n        isArchived: false,\n        lastUpdate: new Date().toISOString(),\n        icon: 'person',\n        color: 'blue',\n        type: 'PERSONAL',\n        members: []\n      };\n      setLedgers([newLedger]);\n      handleChangeActiveBook(data.id);\n    }\n  }, [supabase]);\n\n  const handleChangeActiveBook = useCallback(async (bookId: string) => {\n    setActiveBookId(bookId);\n    localStorage.setItem('finance_active_book_id', bookId); // Persist selection\n    setLedgers(prev => prev.map(l => ({ ...l, isActive: l.id === bookId })));\n\n    // Fetch Data for this Book\n    await Promise.all([\n      fetchAccounts(bookId),\n      fetchCategories(bookId),\n      fetchCategoryFolders(bookId),\n      fetchTransactions(bookId),\n      fetchCommitments(bookId),\n      fetchBudgets(bookId),\n      fetchRecurringRules(bookId)\n    ]);\n  }, [fetchAccounts, fetchCategories, fetchCategoryFolders, fetchTransactions, fetchCommitments, fetchBudgets, fetchRecurringRules]);\n\n\n\n  // ACTIONS\n  const addTransaction = useCallback(async (t: Omit<Transaction, 'id'>) => {\n    if (!activeBookId) return;\n\n    // Find account ID by name (current UI passes name)\n    // In future UI should pass ID. For now, matching by name:\n    const account = accounts.find(a => a.name === t.account);\n    const accountId = account?.id; // Fallback?\n\n    if (!accountId) {\n      console.error(\"Account not found forTransaction name:\", t.account); // Log the name we looked for\n      alert(\"Error: No se encontró la cuenta seleccionada ('\" + t.account + \"'). Por favor selecciona una cuenta válida.\");\n      return;\n    }\n\n    // Find category ID\n    // If t.category is a name, find ID. If t.category_id is provided, use it.\n    let categoryId = t.category_id;\n    if (!categoryId && t.category) {\n      const cat = categories.find(c => c.name === t.category);\n      categoryId = cat?.id;\n    }\n\n    // Handle Location Tracking logic\n    let lat: number | undefined = t.latitude;\n    let lng: number | undefined = t.longitude;\n\n    // If location is enabled in profile and no explicit location passed, try to fetch current\n    if (userProfile?.is_location_enabled && (!lat || !lng)) {\n      try {\n        const pos = await new Promise<GeolocationPosition>((resolve, reject) => {\n          navigator.geolocation.getCurrentPosition(resolve, reject, { timeout: 5000 });\n        });\n        lat = pos.coords.latitude;\n        lng = pos.coords.longitude;\n      } catch (e) {\n        console.warn(\"Could not fetch location for transaction:\", e);\n      }\n    }\n\n    // If t already had coords, they trump everything (passed from manual input maybe)\n    t.latitude = lat;\n    t.longitude = lng;\n\n    const { data, error } = await supabase.from('transactions').insert({\n      book_id: activeBookId,\n      account_id: accountId,\n      type: t.type,\n      amount: t.amount,\n      description: t.description,\n      occurred_at: t.date,\n      category_id: categoryId,\n      currency: account.currency || 'USD',\n      location_text: t.location,\n      location_lat: t.latitude, // Add latitude\n      location_lng: t.longitude, // Add longitude\n      notes: t.notes,\n      beneficiary: t.beneficiary,\n      frequency: t.frequency, // Save frequency to transaction\n      commitment_id: t.commitment_id // Save commitment link\n    }).select().single();\n\n    if (error) {\n      console.error(\"Error creating transaction:\", error);\n      alert(\"Error al guardar: \" + error.message);\n      return;\n    }\n\n    // Update Account Balance manually since no triggers exist\n    if (account) {\n      let newBalance = Number(account.balance);\n      if (t.type === 'INCOME') {\n        newBalance += Number(t.amount);\n      } else {\n        newBalance -= Number(t.amount);\n      }\n\n      const { error: accError } = await supabase\n        .from('accounts')\n        .update({ balance: newBalance })\n        .eq('id', accountId);\n\n      if (accError) {\n        console.error(\"Error updating account balance:\", accError);\n      }\n    }\n\n    // Create Recurring Rule if needed\n    if (data && t.frequency) {\n      let nextDate = new Date(t.date);\n      // Simple logic for next date\n      if (t.frequency === 'DAILY') nextDate.setDate(nextDate.getDate() + 1);\n      if (t.frequency === 'WEEKLY') nextDate.setDate(nextDate.getDate() + 7);\n      if (t.frequency === 'BIWEEKLY') nextDate.setDate(nextDate.getDate() + 14);\n      if (t.frequency === 'MONTHLY') nextDate.setMonth(nextDate.getMonth() + 1);\n      if (t.frequency === 'ANNUAL') nextDate.setFullYear(nextDate.getFullYear() + 1);\n\n      const { error: ruleError } = await supabase.from('recurring_rules').insert({\n        book_id: activeBookId,\n        name: t.description,\n        amount: t.amount,\n        category_id: categoryId,\n        account_id: accountId,\n        type: t.type,\n        frequency: t.frequency,\n        next_run_at: nextDate.toISOString(),\n        end_date: t.end_date,\n        is_active: true\n      });\n\n      if (ruleError) {\n        console.warn(\"Failed to create recurring rule:\", ruleError);\n      } else {\n        fetchRecurringRules(activeBookId);\n      }\n    }\n\n    if (data) {\n      // UI Optimistic Update or Refetch\n      fetchTransactions(activeBookId);\n      fetchAccounts(activeBookId); // Update balances\n    }\n  }, [activeBookId, accounts, categories, userProfile, supabase, fetchRecurringRules, fetchTransactions, fetchAccounts]);\n\n  const addAccount = useCallback(async (a: Omit<Account, 'id'>) => {\n    if (!activeBookId) return;\n\n    // Prepare payload - casting to any to bypass strict database types until migration is run\n    const payload: any = {\n      book_id: activeBookId,\n      name: a.name,\n      type: a.type,\n      balance: a.balance,\n      currency: a.currency,\n      is_default: a.isDefault,\n      // Credit Card Fields\n      credit_limit: a.creditLimit,\n      available_credit: a.availableCredit,\n      pay_day: a.payDay,\n      network: a.network,\n      auto_pay: a.autoPay,\n      last_four: a.lastFour, // Ensure this exists or is removed if unused\n      cardholder_name: a.cardholderName,\n      expiry_date: a.expiryDate,\n      color: 'blue', // Default for now, or passed from 'a' if added to Account type\n      icon: 'account_balance' // Default\n    };\n\n    const { error } = await supabase.from('accounts').insert(payload);\n\n    if (error) {\n      console.error(\"Error creating account:\", error);\n      alert(\"Error creating account: \" + error.message);\n      return;\n    }\n\n    fetchAccounts(activeBookId);\n  }, [activeBookId, supabase, fetchAccounts]);\n\n  const updateAccount = useCallback(async (id: string, a: Partial<Account>) => {\n    if (!activeBookId) return;\n\n    // Prepare payload\n    const payload: any = {\n      name: a.name,\n      type: a.type,\n      balance: a.balance,\n      currency: a.currency,\n      is_default: a.isDefault,\n      credit_limit: a.creditLimit,\n      available_credit: a.availableCredit,\n      cutoff_day: a.cutoffDay,\n      pay_day: a.payDay,\n      network: a.network,\n      auto_pay: a.autoPay,\n      last_four: a.lastFour,\n      cardholder_name: a.cardholderName,\n      expiry_date: a.expiryDate,\n      color: a.color || 'blue', // preserve or update\n    };\n\n    // Remove undefined keys\n    Object.keys(payload).forEach(key => payload[key] === undefined && delete payload[key]);\n\n    const { error } = await supabase.from('accounts').update(payload).eq('id', id);\n\n    if (error) {\n      console.error(\"Error updating account:\", error);\n      alert(\"Error updating account: \" + error.message);\n      return;\n    }\n\n    fetchAccounts(activeBookId);\n  }, [activeBookId, supabase, fetchAccounts]);\n\n  const deleteAccount = useCallback(async (id: string) => {\n    if (!activeBookId) return;\n\n    // Check for dependencies? Ideally transactions cascade or block. \n    // Supabase usually set to CASECADE or RESTRICT. Assuming CASCADE or user handled.\n    const { error } = await supabase.from('accounts').delete().eq('id', id);\n\n    if (error) {\n      console.error(\"Error deleting account:\", error);\n      alert(\"Error al eliminar cuenta: \" + error.message);\n      return;\n    }\n\n    fetchAccounts(activeBookId);\n  }, [activeBookId, supabase, fetchAccounts]);\n\n  const addCommitment = useCallback(async (c: Omit<Commitment, 'id'>) => {\n    if (!activeBookId) return;\n\n    const payload: any = {\n      book_id: activeBookId,\n      title: c.name,\n      amount: c.amount,\n      frequency: c.frequency,\n      next_due_date: c.nextDueDate,\n      status: c.status,\n      type: c.type,\n      is_active: c.isActive,\n      end_date: c.endDate,\n      category_id: c.categoryId,\n      account_id: c.accountId,\n      recurrence: c.recurrence,\n      transaction_type: c.transaction_type,\n      is_auto_pay: c.isAutoPay,\n      funding_account_id: c.fundingAccountId\n    };\n\n    if (!c.categoryId && c.category) {\n      const cat = categories.find(cat => cat.name === c.category);\n      if (cat) payload.category_id = cat.id;\n    }\n\n    if (!c.accountId && c.account) {\n      const acc = accounts.find(a => a.name === c.account);\n      if (acc) payload.account_id = acc.id;\n    }\n\n    const { error } = await supabase.from('commitments').insert(payload);\n\n    if (error) {\n      console.error('Error creating commitment:', error);\n      alert('Error al crear compromiso: ' + error.message);\n      return;\n    }\n\n    fetchCommitments(activeBookId);\n  }, [activeBookId, accounts, categories, supabase, fetchCommitments]);\n\n  const updateCommitment = useCallback(async (id: string, updates: Partial<Commitment>) => {\n    if (!activeBookId) return;\n\n    const payload: any = {};\n    if (updates.name !== undefined) payload.title = updates.name;\n    if (updates.amount !== undefined) payload.amount = updates.amount;\n    if (updates.frequency !== undefined) payload.frequency = updates.frequency;\n    if (updates.nextDueDate !== undefined) payload.next_due_date = updates.nextDueDate;\n    if (updates.status !== undefined) payload.status = updates.status;\n    if (updates.type !== undefined) payload.type = updates.type;\n    if (updates.isActive !== undefined) payload.is_active = updates.isActive;\n    if (updates.endDate !== undefined) payload.end_date = updates.endDate;\n    if (updates.recurrence !== undefined) payload.recurrence = updates.recurrence;\n    if (updates.transaction_type !== undefined) payload.transaction_type = updates.transaction_type;\n    if (updates.isAutoPay !== undefined) payload.is_auto_pay = updates.isAutoPay;\n    if (updates.fundingAccountId !== undefined) payload.funding_account_id = updates.fundingAccountId;\n\n    if (updates.categoryId !== undefined) payload.category_id = updates.categoryId;\n    if (updates.accountId !== undefined) payload.account_id = updates.accountId;\n\n    // Fallback for names\n    if (!updates.categoryId && updates.category) {\n      const cat = categories.find(c => c.name === updates.category);\n      if (cat) payload.category_id = cat.id;\n    }\n    if (!updates.accountId && updates.account) {\n      const acc = accounts.find(a => a.name === updates.account);\n      if (acc) payload.account_id = acc.id;\n    }\n\n    const { error } = await supabase.from('commitments').update(payload).eq('id', id);\n\n    if (error) {\n      console.error('Error updating commitment:', error);\n      alert('Error updating commitment: ' + error.message);\n      return;\n    }\n\n    fetchCommitments(activeBookId);\n  }, [activeBookId, accounts, categories, supabase, fetchCommitments]);\n\n  const deleteCommitment = useCallback(async (id: string) => {\n    const { error } = await supabase.from('commitments').delete().eq('id', id);\n    if (error) {\n      console.error(\"Error deleting commitment:\", error);\n      alert(\"Error deleting commitment: \" + error.message);\n      return;\n    }\n    if (activeBookId) fetchCommitments(activeBookId);\n  }, [activeBookId, supabase, fetchCommitments]);\n\n  const deleteTransaction = useCallback(async (id: string) => {\n    // 1. Fetch transaction details to revert balance\n    const { data: transaction } = await supabase\n      .from('transactions')\n      .select('*')\n      .eq('id', id)\n      .single();\n\n    const { error } = await supabase.from('transactions').delete().eq('id', id);\n    if (error) {\n      console.error(\"Error deleting transaction:\", error);\n      alert(\"Error deleting transaction: \" + error.message);\n      return;\n    }\n\n    // 2. Revert Balance\n    if (transaction && transaction.account_id) {\n      const { data: account } = await supabase\n        .from('accounts')\n        .select('balance')\n        .eq('id', transaction.account_id)\n        .single();\n\n      if (account) {\n        let newBalance = Number(account.balance);\n        // Inverse logic: Deleting Income -> Remove money (Subtract)\n        // Inverse logic: Deleting Expense -> Give back money (Add)\n        if (transaction.type === 'INCOME') {\n          newBalance -= Number(transaction.amount);\n        } else {\n          newBalance += Number(transaction.amount);\n        }\n\n        await supabase\n          .from('accounts')\n          .update({ balance: newBalance })\n          .eq('id', transaction.account_id);\n      }\n    }\n\n    // 3. Update Commitment Status if linked\n    if (transaction && transaction.commitment_id) {\n      await supabase\n        .from('commitments')\n        .update({ status: 'PENDING' })\n        .eq('id', transaction.commitment_id);\n\n      fetchCommitments(activeBookId);\n    }\n\n    if (activeBookId) {\n      fetchTransactions(activeBookId);\n      fetchAccounts(activeBookId);\n    }\n  }, [activeBookId, supabase, fetchTransactions, fetchAccounts, fetchCommitments]);\n\n  const updateTransaction = useCallback(async (id: string, updates: Partial<Transaction>) => {\n    // Map UI fields to DB fields\n    const payload: any = {};\n    if (updates.amount !== undefined) payload.amount = updates.amount;\n    if (updates.description !== undefined) payload.description = updates.description;\n    if (updates.date !== undefined) payload.occurred_at = updates.date;\n    if (updates.type !== undefined) payload.type = updates.type;\n    if (updates.notes !== undefined) payload.notes = updates.notes;\n    if (updates.location !== undefined) payload.location_text = updates.location;\n    if (updates.beneficiary !== undefined) payload.beneficiary = updates.beneficiary;\n    if (updates.frequency !== undefined) payload.frequency = updates.frequency;\n    if (updates.end_date !== undefined) payload.end_date = updates.end_date;\n    if (updates.end_date !== undefined) payload.end_date = updates.end_date;\n    // Relationship updates\n    if (updates.category_id) payload.category_id = updates.category_id;\n    if (updates.account_id) payload.account_id = updates.account_id;\n    // Also support name-based updates if IDs not passed (legacy/UI compatibility)\n    if (!updates.category_id && updates.category) {\n      const cat = categories.find(c => c.name === updates.category);\n      if (cat) payload.category_id = cat.id;\n    }\n\n    payload.updated_at = new Date().toISOString();\n\n    const { error } = await supabase.from('transactions').update(payload).eq('id', id);\n\n    if (error) {\n      console.error(\"Error updating transaction:\", error);\n      alert(\"Error updating transaction: \" + error.message);\n      return;\n    }\n    if (activeBookId) {\n      fetchTransactions(activeBookId);\n      fetchAccounts(activeBookId); // Balance might change\n    }\n  }, [activeBookId, categories, supabase, fetchTransactions, fetchAccounts]);\n\n  const duplicateTransaction = useCallback(async (id: string) => {\n    const original = transactions.find(t => t.id === id);\n    if (!original) return;\n\n    const newTrans: Omit<Transaction, 'id'> = {\n      ...original,\n      date: new Date().toISOString(), // Update to current time\n      notes: (original.notes ? original.notes + \" \" : \"\") + \"(Copia)\",\n      created_at: undefined, // Let DB set this\n      updated_at: undefined\n    };\n\n    await addTransaction(newTrans);\n  }, [transactions, addTransaction]);\n\n  const toggleCommitmentStatus = useCallback(async (id: string, currentStatus: string) => {\n    const newStatus = currentStatus === 'PAID' ? 'PENDING' : 'PAID';\n\n    // Optimistic update\n    await updateCommitment(id, { status: newStatus as any });\n\n    // If marking as PAID, generate the transaction\n    if (newStatus === 'PAID') {\n      const commitment = commitments.find(c => c.id === id);\n      if (commitment) {\n        let transType = commitment.transaction_type || 'EXPENSE';\n        // Safety override: Credit Card payments (Temporal) are always INCOME to the card\n        if (commitment.accountId) {\n          const linkedAccount = accounts.find(a => a.id === commitment.accountId);\n          if (linkedAccount && linkedAccount.type === 'CREDIT' && commitment.type === 'TEMPORAL') {\n            transType = 'INCOME';\n          }\n        }\n\n        const transactionData: any = {\n          book_id: activeBookId,\n          amount: commitment.amount,\n          type: transType,\n          account: commitment.account, // Name is used by addTransaction\n          account_id: commitment.accountId, // Pass ID if available for precision\n          category: commitment.category,\n          category_id: commitment.categoryId,\n          description: `[Compromiso] ${commitment.name}`,\n          date: new Date().toISOString(),\n          notes: 'Generado automáticamente desde Compromisos',\n          commitment_id: id // Link back to commitment\n        };\n\n        await addTransaction(transactionData);\n\n        // If Funding Account exists, create the EXPENSE side (Money leaving Debit)\n        if (commitment.fundingAccountId) {\n          const fundingAcc = accounts.find(a => a.id === commitment.fundingAccountId);\n          if (fundingAcc) {\n            await addTransaction({\n              // book_id handled internally by addTransaction\n              amount: commitment.amount,\n              type: 'EXPENSE',\n              account: fundingAcc.name,\n              account_id: fundingAcc.id,\n              category: commitment.category, // Keep same category? Or \"Transfer\"? Usually same category \"Credit Card Payment\"\n              category_id: commitment.categoryId,\n              description: `[Pago] ${commitment.name}`,\n              date: new Date().toISOString(),\n              notes: `Pago realizado a ${commitment.account}`,\n              icon: 'payments'\n            });\n          }\n        }\n\n        // Generate Next Occurrence for Recurring Commitments\n        if (commitment.frequency && commitment.type !== 'TEMPORAL') {\n          const currentDate = new Date(commitment.nextDueDate);\n          // Ensure valid date\n          if (!isNaN(currentDate.getTime())) {\n            const nextDate = new Date(currentDate);\n\n            // Add time based on frequency (using UTC-safe or local logic? standard JS methods use local)\n            // Just basic iteration:\n            switch (commitment.frequency) {\n              case 'DAILY': nextDate.setDate(nextDate.getDate() + 1); break;\n              case 'WEEKLY': nextDate.setDate(nextDate.getDate() + 7); break;\n              case 'BIWEEKLY': nextDate.setDate(nextDate.getDate() + 14); break;\n              case 'MONTHLY': nextDate.setMonth(nextDate.getMonth() + 1); break;\n              case 'QUARTERLY': nextDate.setMonth(nextDate.getMonth() + 3); break;\n              case 'SEMIANNUAL': nextDate.setMonth(nextDate.getMonth() + 6); break;\n              case 'ANNUAL': nextDate.setFullYear(nextDate.getFullYear() + 1); break;\n            }\n\n            // Check End Date\n            const hasEndDate = commitment.endDate && commitment.endDate.trim() !== '';\n            const isAfterEnd = hasEndDate && new Date(commitment.endDate!) < nextDate;\n\n            if (!isAfterEnd) {\n              // Create the next commitment\n              // We omit 'id' effectively by constructing a new object.\n              // We pass the new calculated date.\n              const nextCommitment = {\n                ...commitment,\n                // Reset status to PENDING for the new one\n                status: 'PENDING' as const,\n                nextDueDate: nextDate.toISOString(),\n                // Keep the rest (name, amount, etc)\n              };\n\n              // Remove IDs from the spread object to avoid TS issues if possible, \n              // but addCommitment accepts Omit<Commitment, 'id'>. \n              // We can cast or just rely on addCommitment implementation ignoring them.\n              // Let's rely on addCommitment implementation which constructs payload explicitly.\n              await addCommitment(nextCommitment);\n            }\n          }\n        }\n      }\n    }\n  }, [activeBookId, commitments, accounts, updateCommitment, addTransaction, addCommitment]);\n\n  const toggleRuleStatus = useCallback((id: string) => {\n    // impl\n  }, []);\n\n  const activateLedger = useCallback((id: string) => {\n    handleChangeActiveBook(id);\n  }, [handleChangeActiveBook]);\n\n  const generateSampleData = useCallback(async () => {\n    if (!activeBookId) return;\n\n    setIsLoading(true);\n\n    // 1. Create Accounts\n    const accountsData = [\n      { book_id: activeBookId, name: 'Chase Sapphire', type: 'CREDIT', balance: -1250.00, last_four: '4242' },\n      { book_id: activeBookId, name: 'Bank of America', type: 'DEBIT', balance: 5430.50, last_four: '8899' },\n      { book_id: activeBookId, name: 'Efectivo', type: 'CASH', balance: 200.00, last_four: 'N/A' },\n      { book_id: activeBookId, name: 'Inversiones', type: 'INVESTMENT', balance: 15000.00, last_four: 'N/A' }\n    ];\n\n    const { data: newAccounts } = await supabase.from('accounts').insert(accountsData).select();\n\n    if (newAccounts) {\n      // 2. Create Transactions (Random dates in last 30 days)\n      const categories = ['Alimentos', 'Transporte', 'Vivienda', 'Entretenimiento', 'Salud', 'Servicios'];\n      const types: TransactionType[] = ['EXPENSE', 'EXPENSE', 'EXPENSE', 'INCOME']; // More expenses usually\n\n      const transactionsData = Array.from({ length: 20 }).map((_, i) => {\n        const type = types[Math.floor(Math.random() * types.length)];\n        const amount = Math.floor(Math.random() * 500) + 10;\n        const account = newAccounts[Math.floor(Math.random() * newAccounts.length)];\n        const category = categories[Math.floor(Math.random() * categories.length)];\n        const date = new Date();\n        date.setDate(date.getDate() - Math.floor(Math.random() * 30));\n\n        return {\n          book_id: activeBookId,\n          account_id: account.id,\n          type: type,\n          amount: type === 'INCOME' ? amount * 5 : amount,\n          description: `Movimiento de prueba ${i + 1}`,\n          category_id: null, // text for now\n          occurred_at: date.toISOString(),\n          // Metadata stored in JSON or simplified for this quick mocked context\n        };\n      });\n\n      await supabase.from('transactions').insert(transactionsData);\n\n      // 3. Create Commitments\n      await supabase.from('commitments').insert([\n        { book_id: activeBookId, title: 'Netflix Premium', amount: 15.99, frequency: 'MONTHLY', next_due_date: new Date().toISOString(), status: 'PENDING' },\n        { book_id: activeBookId, title: 'Spotify Couple', amount: 12.99, frequency: 'MONTHLY', next_due_date: new Date().toISOString(), status: 'PAID' },\n        { book_id: activeBookId, title: 'Gym Membership', amount: 45.00, frequency: 'MONTHLY', next_due_date: new Date().toISOString(), status: 'PENDING' },\n      ]);\n    }\n\n    // Refresh all\n    await handleChangeActiveBook(activeBookId);\n    setIsLoading(false);\n  }, [activeBookId, supabase, handleChangeActiveBook]);\n\n  const addBudget = useCallback(async (budgetData: { amount: number; categoryId: string; recurrenceType?: string; recurrenceInterval?: number; startDate?: string; endDate?: string }) => {\n    if (!activeBookId) return;\n\n    const { error } = await supabase.from('budgets').insert({\n      book_id: activeBookId,\n      category_id: budgetData.categoryId,\n      amount: budgetData.amount,\n      recurrence_type: budgetData.recurrenceType || 'MONTHLY',\n      recurrence_interval: budgetData.recurrenceInterval || 1,\n      start_date: budgetData.startDate || new Date().toISOString(),\n      end_date: budgetData.endDate || null,\n      period: 'MONTHLY' // Default for legacy/required DB column if I made it NOT NULL default 'MONTHLY'\n    });\n\n    if (error) {\n      console.error('Error creating budget:', error);\n      alert('Error al crear presupuesto: ' + error.message);\n      return;\n    }\n\n    await fetchBudgets(activeBookId);\n  }, [activeBookId, supabase, fetchBudgets]);\n\n  const deleteBudget = useCallback(async (id: string) => {\n    if (!activeBookId) return;\n\n    const { error } = await supabase.from('budgets').delete().eq('id', id);\n\n    if (error) {\n      console.error('Error deleting budget:', error);\n      alert('Error al eliminar presupuesto: ' + error.message);\n      return;\n    }\n\n    await fetchBudgets(activeBookId);\n  }, [activeBookId, supabase, fetchBudgets]);\n\n  const updateBudget = useCallback(async (id: string, updates: Partial<{ amount: number; categoryId: string; recurrenceType?: string; recurrenceInterval?: number; startDate?: string; endDate?: string }>) => {\n    if (!activeBookId) return;\n\n    const payload: any = {};\n    if (updates.amount !== undefined) payload.amount = updates.amount;\n    if (updates.categoryId !== undefined) payload.category_id = updates.categoryId;\n    if (updates.recurrenceType !== undefined) payload.recurrence_type = updates.recurrenceType;\n    if (updates.recurrenceInterval !== undefined) payload.recurrence_interval = updates.recurrenceInterval;\n    if (updates.startDate !== undefined) payload.start_date = updates.startDate;\n    if (updates.endDate !== undefined) payload.end_date = updates.endDate;\n\n    const { error } = await supabase.from('budgets').update(payload).eq('id', id);\n\n    if (error) {\n      console.error('Error updating budget:', error);\n      alert('Error al actualizar presupuesto: ' + error.message);\n      return;\n    }\n\n    await fetchBudgets(activeBookId);\n  }, [activeBookId, supabase, fetchBudgets]);\n\n  const checkRecurringBudgets = useCallback(async () => {\n    if (!activeBookId || budgets.length === 0) return;\n\n    const today = new Date();\n    const createdBudgets: any[] = [];\n\n    for (const budget of budgets) {\n      if (!budget.recurrence_type || budget.recurrence_type === 'NONE' || !budget.start_date) continue;\n\n      const startDate = new Date(budget.start_date);\n      const endDate = budget.end_date ? new Date(budget.end_date) : null;\n\n      let nextStartDate: Date | null = null;\n      let nextEndDate: Date | null = null;\n\n      if (!endDate) continue;\n\n      if (isBefore(endDate, today)) {\n        nextStartDate = addDays(endDate, 1);\n\n        if (budget.recurrence_type === 'MONTHLY') {\n          nextStartDate = addMonths(startDate, 1);\n          nextEndDate = endOfMonth(nextStartDate);\n        } else if (budget.recurrence_type === 'WEEKLY') {\n          nextStartDate = addWeeks(startDate, 1);\n          nextEndDate = addDays(nextStartDate, 6);\n        } else if (budget.recurrence_type === 'BIWEEKLY') {\n          nextStartDate = addDays(startDate, 14);\n          nextEndDate = addDays(nextStartDate, 13);\n        } else if (budget.recurrence_type === 'ANNUAL') {\n          nextStartDate = addYears(startDate, 1);\n          nextEndDate = new Date(nextStartDate.getFullYear(), 11, 31);\n        } else {\n          continue;\n        }\n\n        const exists = budgets.some(b =>\n          b.category_id === budget.category_id &&\n          isSameDay(new Date(b.start_date), nextStartDate!)\n        );\n\n        if (!exists && nextStartDate) {\n          createdBudgets.push({\n            book_id: activeBookId,\n            category_id: budget.category_id,\n            amount: budget.limit,\n            recurrence_type: budget.recurrence_type,\n            recurrence_interval: budget.recurrence_interval,\n            start_date: nextStartDate.toISOString(),\n            end_date: nextEndDate ? nextEndDate.toISOString() : null,\n            period: 'MONTHLY'\n          });\n        }\n      }\n    }\n\n    if (createdBudgets.length > 0) {\n      console.log(\"Generating recurring budgets:\", createdBudgets.length);\n      const { error } = await supabase.from('budgets').insert(createdBudgets);\n      if (error) {\n        console.error(\"Error generating recurring budgets:\", error);\n      } else {\n        await fetchBudgets(activeBookId);\n      }\n    }\n  }, [activeBookId, budgets, supabase, fetchBudgets]);\n\n  const checkAutoPayCommitments = useCallback(async () => {\n    if (!activeBookId || commitments.length === 0) return;\n\n    const today = new Date();\n    today.setHours(0, 0, 0, 0);\n\n    const pendingAutoPay = commitments.filter(c =>\n      c.isActive &&\n      c.isAutoPay &&\n      c.status === 'PENDING' &&\n      new Date(c.nextDueDate) <= today\n    );\n\n    for (const commitment of pendingAutoPay) {\n      console.log(`Auto-paying commitment: ${commitment.name}`);\n      await toggleCommitmentStatus(commitment.id, 'PENDING');\n    }\n  }, [activeBookId, commitments, toggleCommitmentStatus]);\n\n  useEffect(() => {\n    if (!isLoading && activeBookId && commitments.length > 0) {\n      checkAutoPayCommitments();\n    }\n  }, [isLoading, activeBookId, commitments]);\n\n  // Modal State\n  const [isTransactionModalOpen, setIsTransactionModalOpen] = useState(false);\n\n  const openTransactionModal = () => setIsTransactionModalOpen(true);\n  const closeTransactionModal = () => setIsTransactionModalOpen(false);\n\n  const totalBalance = useMemo(() => accounts.reduce((sum, acc) => sum + acc.balance, 0), [accounts]);\n\n  const fetchUserProfile = useCallback(async () => {\n    const { data: { user } } = await supabase.auth.getUser();\n    if (!user) return;\n\n    let { data, error } = await supabase\n      .from('profiles')\n      .select('*')\n      .eq('id', user.id)\n      .single();\n\n    if (error && error.code !== 'PGRST116') {\n      console.error(\"Error fetching user profile:\", error);\n    }\n\n    if (error && error.code === 'PGRST116') {\n      // Profile doesn't exist, create it\n      const newProfile = {\n        id: user.id,\n        full_name: 'Paul', // Default as requested\n        email: user.email || '',\n        phone: '',\n        username: '@paul',\n        language: 'es',\n        currency: 'PEN',\n        country: 'Peru',\n        city: 'Lima',\n        notifications_enabled: true,\n        two_factor_enabled: false\n      };\n\n      const { data: createdProfile, error: createError } = await supabase\n        .from('profiles')\n        .insert(newProfile)\n        .select()\n        .single();\n\n      if (createError) {\n        console.error(\"Error creating default profile:\", createError);\n      } else {\n        data = createdProfile;\n      }\n    }\n\n    if (data) {\n      // Prioritize Auth email over DB email to ensure accuracy for display\n      setUserProfile({\n        ...data,\n        email: user.email || data.email || '',\n        email_confirmed_at: user.email_confirmed_at || null\n      });\n    }\n  }, [supabase]);\n\n  const updateUserProfile = useCallback(async (updates: Partial<UserProfile>) => {\n    const { data: { user } } = await supabase.auth.getUser();\n    if (!user) return;\n\n    // Handle Email Update in Auth (if changed)\n    if (updates.email && updates.email !== user.email) {\n      const { error: authError } = await supabase.auth.updateUser({ email: updates.email });\n\n      if (authError) {\n        console.error(\"Error updating auth email:\", authError);\n        alert(\"Error al actualizar correo de inicio de sesión: \" + authError.message);\n        return; // Stop execution if auth update fails to prevent inconsistency\n      }\n\n      alert(`Se ha solicitado el cambio de correo a ${updates.email}. Por favor revisa tu bandeja de entrada para confirmar el cambio.`);\n    }\n\n    // Update Profile Data in Database\n    const { error } = await supabase\n      .from('profiles')\n      .update(updates)\n      .eq('id', user.id);\n\n    if (error) {\n      console.error(\"Error updating profile:\", error);\n      alert(\"Error al actualizar perfil: \" + error.message);\n    } else {\n      fetchUserProfile();\n    }\n  }, [supabase, fetchUserProfile]);\n\n  const updatePassword = useCallback(async (current: string, newPass: string): Promise<boolean> => {\n    const { data: { user } } = await supabase.auth.getUser();\n    if (!user || !user.email) return false;\n\n    // 1. Re-authenticate\n    const { error: signInError } = await supabase.auth.signInWithPassword({\n      email: user.email,\n      password: current\n    });\n\n    if (signInError) {\n      console.error(\"Re-authentication failed:\", signInError);\n      alert(\"La contraseña actual es incorrecta.\");\n      return false;\n    }\n\n    // 2. Update Password\n    const { error: updateError } = await supabase.auth.updateUser({ password: newPass });\n\n    if (updateError) {\n      console.error(\"Error updating password:\", updateError);\n      alert(\"Error al actualizar contraseña: \" + updateError.message);\n      return false;\n    }\n\n    return true;\n  }, [supabase]);\n\n  const resetPasswordForEmail = useCallback(async (email: string): Promise<boolean> => {\n    const { error } = await supabase.auth.resetPasswordForEmail(email);\n    if (error) {\n      console.error(\"Error sending reset email:\", error);\n      alert(\"Error al enviar el correo: \" + error.message);\n      return false;\n    }\n    return true;\n  }, [supabase]);\n\n  const deleteUserAccount = useCallback(async () => {\n    const { data: { user } } = await supabase.auth.getUser();\n    if (!user) return;\n\n    try {\n      setIsLoading(true);\n\n      // 1. Delete dependent data (reverse order of creation/dependency)\n      // Transactions\n      await supabase.from('transactions').delete().eq('user_id', user.id);\n\n      // Commitments\n      await supabase.from('commitments').delete().eq('user_id', user.id);\n\n      // Budgets\n      await supabase.from('budgets').delete().eq('user_id', user.id);\n\n      // Accounts\n      await supabase.from('accounts').delete().eq('user_id', user.id);\n\n      // Ledgers/Books (and member relations if any)\n      await supabase.from('books').delete().eq('owner', user.id); // Assuming owner field or RLS handles it\n\n      // Profile\n      const { error: profileError } = await supabase.from('profiles').delete().eq('id', user.id);\n      if (profileError) {\n        throw profileError;\n      }\n\n      // 2. Sign out\n      await supabase.auth.signOut();\n\n      // 3. Optional: Redirect is usually handled by auth state change listener in layout\n      // window.location.href = '/login'; \n\n    } catch (error: any) {\n      console.error(\"Error deleting account:\", error);\n      alert(\"Error al eliminar la cuenta: \" + error.message);\n    } finally {\n      setIsLoading(false);\n    }\n  }, [supabase, setIsLoading]);\n\n  const uploadAvatar = useCallback(async (file: File): Promise<string | null> => {\n    const { data: { user } } = await supabase.auth.getUser();\n    if (!user) return null;\n\n    const fileExt = file.name.split('.').pop();\n    const fileName = `${user.id}-${Math.random()}.${fileExt}`;\n    const filePath = `${user.id}/${fileName}`;\n\n    const { error: uploadError } = await supabase.storage\n      .from('avatars')\n      .upload(filePath, file);\n\n    if (uploadError) {\n      console.error('Error uploading avatar:', uploadError);\n      return null;\n    }\n\n    const { data: { publicUrl } } = supabase.storage\n      .from('avatars')\n      .getPublicUrl(filePath);\n\n    return publicUrl;\n  }, [supabase]);\n\n  useEffect(() => {\n    // Fetch profile on mount if authorized\n    fetchUserProfile();\n  }, []);\n\n\n\n  const contextValue = useMemo(() => ({\n    transactions,\n    accounts,\n    categories,\n    categoryFolders,\n    budgets,\n    commitments,\n    recurringRules,\n    ledgers,\n    userProfile,\n    fetchUserProfile,\n    updateUserProfile,\n    uploadAvatar,\n    addTransaction,\n    deleteTransaction,\n    addAccount,\n    updateAccount,\n    deleteAccount,\n    addCommitment,\n    updateCommitment,\n    deleteCommitment,\n    toggleCommitmentStatus,\n    updateTransaction,\n    duplicateTransaction,\n    toggleRuleStatus,\n    activateLedger,\n    generateSampleData,\n    totalBalance,\n    isDarkMode,\n    toggleTheme,\n    isLoading,\n    activeBookId,\n    refreshBooks,\n    formatAmount,\n    isTransactionModalOpen,\n    openTransactionModal,\n    closeTransactionModal,\n    addBudget,\n    updateBudget,\n    deleteBudget,\n    checkRecurringBudgets,\n    deleteCategory: async (id: string) => {\n      if (!activeBookId) return;\n      const { error } = await supabase.from('categories').delete().eq('id', id);\n      if (error) {\n        console.error(\"Error deleting category:\", error);\n        alert(\"Error al eliminar categoría: \" + error.message);\n      } else {\n        await fetchCategories(activeBookId);\n      }\n    },\n    deleteCategoryFolder: async (id: string) => {\n      if (!activeBookId) return;\n      const { error } = await supabase.from('category_folders').delete().eq('id', id);\n      if (error) {\n        console.error(\"Error deleting folder:\", error);\n        alert(\"Error al eliminar carpeta: \" + error.message);\n      } else {\n        await fetchCategoryFolders(activeBookId);\n        await fetchCategories(activeBookId);\n      }\n    },\n    notifications,\n    unreadCount,\n    markNotificationAsRead,\n    markAllNotificationsAsRead,\n    updatePassword,\n    resetPasswordForEmail,\n    deleteUserAccount\n  }), [\n    transactions,\n    accounts,\n    categories,\n    categoryFolders,\n    budgets,\n    commitments,\n    recurringRules,\n    ledgers,\n    userProfile,\n    fetchUserProfile,\n    updateUserProfile,\n    uploadAvatar,\n    addTransaction,\n    deleteTransaction,\n    addAccount,\n    updateAccount,\n    deleteAccount,\n    addCommitment,\n    updateCommitment,\n    deleteCommitment,\n    toggleCommitmentStatus,\n    updateTransaction,\n    duplicateTransaction,\n    toggleRuleStatus,\n    activateLedger,\n    generateSampleData,\n    totalBalance,\n    isDarkMode,\n    toggleTheme,\n    isLoading,\n    activeBookId,\n    refreshBooks,\n    formatAmount,\n    isTransactionModalOpen,\n    addBudget,\n    updateBudget,\n    deleteBudget,\n    checkRecurringBudgets,\n    notifications,\n    unreadCount,\n    markNotificationAsRead,\n    markAllNotificationsAsRead,\n    supabase\n  ]);\n\n  return (\n    <FinanceContext.Provider value={contextValue}>\n      {children}\n    </FinanceContext.Provider>\n  );\n};\n\nexport const useFinance = () => {\n  const context = useContext(FinanceContext);\n  if (!context) throw new Error('useFinance must be used within a FinanceProvider');\n  return context;\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1746, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/PD%20-%20255%20SSD/Cio/Proyectos/Internos/Apps/finanzas-pro/components/TransactionModal.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useState, useEffect } from 'react';\nimport { useFinance } from '@/context/FinanceContext';\nimport { Transaction, TransactionType } from '@/types';\nimport { format } from 'date-fns';\n\ninterface TransactionModalProps {\n    isOpen?: boolean;\n    onClose?: () => void;\n    transactionToEdit?: Transaction | null;\n}\n\nexport const TransactionModal = ({ isOpen, onClose, transactionToEdit }: TransactionModalProps) => {\n    const {\n        isTransactionModalOpen,\n        closeTransactionModal,\n        addTransaction,\n        updateTransaction,\n        accounts,\n        categories,\n        formatAmount,\n        ledgers,\n        activeBookId\n    } = useFinance();\n\n    const finalIsOpen = isOpen !== undefined ? isOpen : isTransactionModalOpen;\n    const finalOnClose = onClose || closeTransactionModal;\n\n    const [amount, setAmount] = useState('');\n    const [description, setDescription] = useState('');\n    const [type, setType] = useState<TransactionType>('EXPENSE');\n    const [categoryId, setCategoryId] = useState('');\n    const [accountId, setAccountId] = useState('');\n    // Initialize with local date\n    const [date, setDate] = useState(format(new Date(), 'yyyy-MM-dd'));\n    const [time, setTime] = useState(new Date().toTimeString().slice(0, 5));\n    const [location, setLocation] = useState('');\n    const [notes, setNotes] = useState('');\n    const [beneficiary, setBeneficiary] = useState('');\n    const [isPending, setIsPending] = useState(false);\n    const [isRecurring, setIsRecurring] = useState(false);\n    const [frequency, setFrequency] = useState('MONTHLY');\n    const [endDate, setEndDate] = useState('');\n\n    // Reset or Populate form\n    useEffect(() => {\n        if (finalIsOpen) {\n            if (transactionToEdit) {\n                // Edit Mode\n                setAmount(transactionToEdit.amount.toString());\n                setDescription(transactionToEdit.description);\n                setType(transactionToEdit.type);\n                setCategoryId(transactionToEdit.category_id || categories.find(c => c.name === transactionToEdit.category)?.id || '');\n                setAccountId(transactionToEdit.account_id || accounts.find(a => a.name === transactionToEdit.account)?.id || '');\n\n                const d = new Date(transactionToEdit.date);\n                // When editing, we rely on the stored date string being correct or standardized.\n                // But usually we just want to display the date part. \n                // If stored in UTC ISO, splitting T might be okay IF it was stored correctly.\n                // However, let's keep the existing logic for EDIT for now, or ensure consistency.\n                // Usually edit takes what's in DB.\n                setDate(d.toISOString().split('T')[0]);\n                setTime(d.toTimeString().slice(0, 5));\n\n                setLocation(transactionToEdit.location || '');\n                setNotes(transactionToEdit.notes || '');\n                setBeneficiary(transactionToEdit.beneficiary || '');\n                setIsPending(transactionToEdit.status === 'PENDING');\n                setIsRecurring(transactionToEdit.isRecurring || false);\n                setFrequency(transactionToEdit.frequency || 'MONTHLY');\n                const endDateVal = transactionToEdit.end_date ? new Date(transactionToEdit.end_date).toISOString().split('T')[0] : '';\n                setEndDate(endDateVal);\n            } else {\n                // Create Mode\n                setAmount('');\n                setDescription('');\n                setType('EXPENSE');\n                setCategoryId('');\n                setAccountId(accounts[0]?.id || '');\n\n                // Use local time for new transactions\n                const now = new Date();\n                setDate(format(now, 'yyyy-MM-dd'));\n                setTime(now.toTimeString().slice(0, 5));\n\n                setLocation('');\n                setNotes('');\n                setBeneficiary('');\n                setIsPending(false);\n                setIsRecurring(false);\n                setFrequency('MONTHLY');\n                setEndDate('');\n            }\n        }\n    }, [finalIsOpen, transactionToEdit, accounts, categories]);\n\n    const handleSubmit = async (e: React.FormEvent) => {\n        e.preventDefault();\n\n        const numAmount = parseFloat(amount);\n        if (isNaN(numAmount) || numAmount <= 0) {\n            alert('Por favor ingresa un monto válido');\n            return;\n        }\n\n        if (!accountId) {\n            alert('Por favor selecciona una cuenta');\n            return;\n        }\n\n        const dateTime = new Date(`${date}T${time}`);\n        const selectedAccount = accounts.find(a => a.id === accountId);\n\n        const transactionData = {\n            amount: numAmount,\n            type: type,\n            description: description || (type === 'INCOME' ? 'Ingreso' : 'Gasto'),\n            account: selectedAccount?.name || 'Unknown',\n            account_id: accountId,\n            category_id: categoryId || undefined,\n            category: categories.find(c => c.id === categoryId)?.name || 'Sin categoría',\n            date: dateTime.toISOString(),\n            status: (isPending ? 'PENDING' : 'COMPLETED') as 'PENDING' | 'COMPLETED',\n            location: location,\n            notes: notes,\n            beneficiary: beneficiary,\n            icon: type === 'INCOME' ? 'trending_up' : 'trending_down',\n            isRecurring: isRecurring,\n            frequency: isRecurring ? frequency : null,\n            end_date: isRecurring && endDate ? new Date(endDate).toISOString() : null\n        };\n\n        if (transactionToEdit) {\n            await updateTransaction(transactionToEdit.id, transactionData);\n        } else {\n            await addTransaction(transactionData);\n        }\n\n        finalOnClose();\n    };\n\n    // Close on Escape key\n    useEffect(() => {\n        const handleKeyDown = (e: KeyboardEvent) => {\n            if (e.key === 'Escape' && finalIsOpen) {\n                finalOnClose();\n            }\n        };\n        window.addEventListener('keydown', handleKeyDown);\n        return () => window.removeEventListener('keydown', handleKeyDown);\n    }, [finalIsOpen, finalOnClose]);\n\n    if (!finalIsOpen) return null;\n\n    return (\n        <div\n            className=\"fixed top-0 bottom-0 right-0 left-0 lg:left-[var(--sidebar-width)] z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-fade-in transition-[left] duration-300\"\n            onClick={finalOnClose}\n        >\n            <div\n                className=\"bg-white dark:bg-[#1e2530] w-full max-w-4xl rounded-3xl shadow-2xl overflow-hidden flex flex-col md:flex-row max-h-[90vh]\"\n                onClick={(e) => e.stopPropagation()}\n            >\n\n                {/* Left Side - Amount & Type */}\n                <div className=\"w-full md:w-5/12 bg-gray-50 dark:bg-[#252b36] p-8 flex flex-col justify-center items-center relative border-b md:border-b-0 md:border-r border-gray-100 dark:border-white/5\">\n                    <div className=\"absolute top-6 left-1/2 -translate-x-1/2 bg-gray-200 dark:bg-[#2f3642] p-1 rounded-xl flex\">\n                        <button\n                            onClick={() => setType('EXPENSE')}\n                            className={`px-6 py-2 rounded-lg text-sm font-bold transition-all ${type === 'EXPENSE' ? 'bg-white dark:bg-[#1e2530] shadow-sm text-danger' : 'text-gray-500 dark:text-gray-400 hover:text-gray-700'}`}\n                        >\n                            Gasto\n                        </button>\n                        <button\n                            onClick={() => setType('INCOME')}\n                            className={`px-6 py-2 rounded-lg text-sm font-bold transition-all ${type === 'INCOME' ? 'bg-white dark:bg-[#1e2530] shadow-sm text-success' : 'text-gray-500 dark:text-gray-400 hover:text-gray-700'}`}\n                        >\n                            Ingreso\n                        </button>\n                    </div>\n\n                    <div className=\"mt-12 text-center w-full\">\n                        <p className=\"text-xs font-bold text-gray-400 uppercase tracking-widest mb-4\">MONTO TOTAL</p>\n                        <div className=\"relative w-full max-w-[280px] mx-auto\">\n                            <input\n                                type=\"number\"\n                                value={amount}\n                                onChange={(e) => setAmount(e.target.value)}\n                                placeholder=\"0.00\"\n                                className={`w-full bg-transparent text-6xl font-black text-center outline-none border-b-2 border-transparent focus:border-primary/50 transition-colors pb-2 placeholder-gray-200 dark:placeholder-gray-700 ${type === 'INCOME' ? 'text-success' : 'text-text-main dark:text-white'}`}\n                                autoFocus\n                            />\n                            <span className={`absolute top-2 -left-6 text-4xl font-medium ${type === 'INCOME' ? 'text-success/50' : 'text-gray-300 dark:text-gray-600'}`}>\n                                {ledgers.find(l => l.id === activeBookId)?.currency || '$'}\n                            </span>\n                        </div>\n                    </div>\n\n                    <div className=\"mt-auto w-full\">\n                        <label className=\"block text-xs font-bold text-gray-400 uppercase tracking-widest mb-3\">Cuenta de Origen</label>\n                        <div className=\"relative\">\n                            <select\n                                value={accountId}\n                                onChange={(e) => setAccountId(e.target.value)}\n                                className=\"w-full appearance-none bg-white dark:bg-[#1e2530] border border-gray-200 dark:border-gray-700 text-gray-700 dark:text-white rounded-xl px-4 py-3 pr-10 font-semibold focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all cursor-pointer\"\n                            >\n                                {accounts.map(acc => (\n                                    <option key={acc.id} value={acc.id}>\n                                        {acc.name} ({formatAmount(acc.balance)})\n                                    </option>\n                                ))}\n                            </select>\n                            <div className=\"absolute inset-y-0 right-0 flex items-center px-4 pointer-events-none text-gray-500\">\n                                <span className=\"material-symbols-outlined\">expand_more</span>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                {/* Right Side - Details Form */}\n                <div className=\"w-full md:w-7/12 p-8 overflow-y-auto custom-scrollbar bg-white dark:bg-[#1e2530]\">\n                    <div className=\"flex justify-between items-center mb-8\">\n                        <h2 className=\"text-xl font-bold text-gray-800 dark:text-white\">Nueva Transacción</h2>\n                        <button onClick={finalOnClose} className=\"p-2 hover:bg-gray-100 dark:hover:bg-white/5 rounded-full transition-colors\">\n                            <span className=\"material-symbols-outlined text-gray-500\">close</span>\n                        </button>\n                    </div>\n\n                    <form onSubmit={handleSubmit} className=\"flex flex-col gap-6\">\n\n                        {/* Category */}\n                        <div>\n                            <label className=\"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2\">Categoría</label>\n                            <div className=\"relative group\">\n                                <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n                                    <span className=\"material-symbols-outlined text-gray-400 group-focus-within:text-primary transition-colors\">category</span>\n                                </div>\n                                <select\n                                    value={categoryId}\n                                    onChange={(e) => setCategoryId(e.target.value)}\n                                    className=\"w-full pl-10 pr-4 py-3 bg-gray-50 dark:bg-[#252b36] border border-gray-200 dark:border-gray-700/50 rounded-xl focus:ring-2 focus:ring-primary/20 focus:border-primary focus:bg-white dark:focus:bg-[#252b36] transition-all outline-none font-medium text-gray-700 dark:text-white cursor-pointer\"\n                                >\n                                    <option value=\"\">Selecciona una categoría...</option>\n                                    {categories.map(cat => (\n                                        <option key={cat.id} value={cat.id}>{cat.name}</option>\n                                    ))}\n                                </select>\n                            </div>\n                        </div>\n\n                        {/* Description */}\n                        <div>\n                            <label className=\"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2\">Descripción / Beneficiario</label>\n                            <div className=\"relative group\">\n                                <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n                                    <span className=\"material-symbols-outlined text-gray-400 group-focus-within:text-primary transition-colors\">description</span>\n                                </div>\n                                <input\n                                    type=\"text\"\n                                    value={description}\n                                    onChange={(e) => setDescription(e.target.value)}\n                                    placeholder=\"Ej. Compra semanal, Starbucks, Nómina...\"\n                                    className=\"w-full pl-10 pr-4 py-3 bg-gray-50 dark:bg-[#252b36] border border-gray-200 dark:border-gray-700/50 rounded-xl focus:ring-2 focus:ring-primary/20 focus:border-primary focus:bg-white dark:focus:bg-[#252b36] transition-all outline-none font-medium text-gray-700 dark:text-white placeholder-gray-400\"\n                                />\n                            </div>\n                        </div>\n\n                        {/* Date & Time Row */}\n                        <div className=\"grid grid-cols-2 gap-4\">\n                            <div>\n                                <label className=\"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2\">Fecha</label>\n                                <div className=\"relative group\">\n                                    <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n                                        <span className=\"material-symbols-outlined text-gray-400 group-focus-within:text-primary transition-colors\">calendar_today</span>\n                                    </div>\n                                    <input\n                                        type=\"date\"\n                                        value={date}\n                                        onChange={(e) => setDate(e.target.value)}\n                                        className=\"w-full pl-10 pr-4 py-3 bg-gray-50 dark:bg-[#252b36] border border-gray-200 dark:border-gray-700/50 rounded-xl focus:ring-2 focus:ring-primary/20 focus:border-primary focus:bg-white dark:focus:bg-[#252b36] transition-all outline-none font-medium text-gray-700 dark:text-white\"\n                                    />\n                                </div>\n                            </div>\n                            <div>\n                                <label className=\"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2\">Hora</label>\n                                <div className=\"relative group\">\n                                    <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n                                        <span className=\"material-symbols-outlined text-gray-400 group-focus-within:text-primary transition-colors\">schedule</span>\n                                    </div>\n                                    <input\n                                        type=\"time\"\n                                        value={time}\n                                        onChange={(e) => setTime(e.target.value)}\n                                        className=\"w-full pl-10 pr-4 py-3 bg-gray-50 dark:bg-[#252b36] border border-gray-200 dark:border-gray-700/50 rounded-xl focus:ring-2 focus:ring-primary/20 focus:border-primary focus:bg-white dark:focus:bg-[#252b36] transition-all outline-none font-medium text-gray-700 dark:text-white\"\n                                    />\n                                </div>\n                            </div>\n                        </div>\n\n                        {/* Location */}\n                        <div>\n                            <label className=\"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2\">Ubicación</label>\n                            <div className=\"relative group\">\n                                <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n                                    <span className=\"material-symbols-outlined text-gray-400 group-focus-within:text-primary transition-colors\">location_on</span>\n                                </div>\n                                <input\n                                    type=\"text\"\n                                    value={location}\n                                    onChange={(e) => setLocation(e.target.value)}\n                                    placeholder=\"Añadir ubicación...\"\n                                    className=\"w-full pl-10 pr-4 py-3 bg-gray-50 dark:bg-[#252b36] border border-gray-200 dark:border-gray-700/50 rounded-xl focus:ring-2 focus:ring-primary/20 focus:border-primary focus:bg-white dark:focus:bg-[#252b36] transition-all outline-none font-medium text-gray-700 dark:text-white placeholder-gray-400\"\n                                />\n                                <div className=\"absolute inset-y-0 right-0 pr-3 flex items-center\">\n                                    <button type=\"button\" className=\"p-1 hover:bg-gray-200 dark:hover:bg-white/10 rounded-full transition-colors text-gray-400\" title=\"Usar ubicación actual\">\n                                        <span className=\"material-symbols-outlined text-[18px]\">my_location</span>\n                                    </button>\n                                </div>\n                            </div>\n                        </div>\n\n                        {/* Notes */}\n                        <div>\n                            <label className=\"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2\">Notas</label>\n                            <textarea\n                                value={notes}\n                                onChange={(e) => setNotes(e.target.value)}\n                                placeholder=\"Notas adicionales...\"\n                                rows={2}\n                                className=\"w-full p-4 bg-gray-50 dark:bg-[#252b36] border border-gray-200 dark:border-gray-700/50 rounded-xl focus:ring-2 focus:ring-primary/20 focus:border-primary focus:bg-white dark:focus:bg-[#252b36] transition-all outline-none font-medium text-gray-700 dark:text-white placeholder-gray-400 resize-none\"\n                            />\n                        </div>\n\n                        {/* Toggles */}\n                        <div className=\"flex gap-6 py-2\">\n                            <label className=\"flex items-center gap-3 cursor-pointer group select-none\">\n                                <div className={`w-12 h-6 rounded-full p-1 transition-colors duration-300 ${isPending ? 'bg-primary' : 'bg-gray-200 dark:bg-gray-700'}`}>\n                                    <div className={`bg-white size-4 rounded-full shadow-md transform transition-transform duration-300 ${isPending ? 'translate-x-6' : ''}`}></div>\n                                </div>\n                                <span className=\"text-sm font-semibold text-gray-700 dark:text-gray-300 group-hover:text-primary transition-colors\">Pendiente</span>\n                                <input type=\"checkbox\" checked={isPending} onChange={(e) => setIsPending(e.target.checked)} className=\"hidden\" />\n                            </label>\n\n                            <label className=\"flex items-center gap-3 cursor-pointer group select-none\">\n                                <div className={`w-12 h-6 rounded-full p-1 transition-colors duration-300 ${isRecurring ? 'bg-primary' : 'bg-gray-200 dark:bg-gray-700'}`}>\n                                    <div className={`bg-white size-4 rounded-full shadow-md transform transition-transform duration-300 ${isRecurring ? 'translate-x-6' : ''}`}></div>\n                                </div>\n                                <span className=\"text-sm font-semibold text-gray-700 dark:text-gray-300 group-hover:text-primary transition-colors\">Recurrente</span>\n                                <input type=\"checkbox\" checked={isRecurring} onChange={(e) => setIsRecurring(e.target.checked)} className=\"hidden\" />\n                            </label>\n                        </div>\n\n                        {/* Frequency Dropdown */}\n                        {isRecurring && (\n                            <div className=\"animate-fade-in-down\">\n                                <label className=\"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2\">Frecuencia</label>\n                                <div className=\"relative group\">\n                                    <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n                                        <span className=\"material-symbols-outlined text-gray-400 group-focus-within:text-primary transition-colors\">repeat</span>\n                                    </div>\n                                    <select\n                                        value={frequency}\n                                        onChange={(e) => setFrequency(e.target.value)}\n                                        className=\"w-full pl-10 pr-4 py-3 bg-gray-50 dark:bg-[#252b36] border border-gray-200 dark:border-gray-700/50 rounded-xl focus:ring-2 focus:ring-primary/20 focus:border-primary focus:bg-white dark:focus:bg-[#252b36] transition-all outline-none font-medium text-gray-700 dark:text-white cursor-pointer appearance-none\"\n                                    >\n                                        <option value=\"DAILY\">Diariamente</option>\n                                        <option value=\"WEEKLY\">Semanalmente</option>\n                                        <option value=\"BIWEEKLY\">Cada 2 semanas</option>\n                                        <option value=\"WEEKLY_3\">Cada 3 semanas</option>\n                                        <option value=\"WEEKLY_4\">Cada 4 semanas</option>\n                                        <option value=\"MONTHLY\">Mensual</option>\n                                        <option value=\"BIMONTHLY\">Cada 2 meses</option>\n                                        <option value=\"QUARTERLY\">Trimestral</option>\n                                        <option value=\"SEMIANNUAL\">Semestral</option>\n                                        <option value=\"ANNUAL\">Anual</option>\n                                    </select>\n                                    <div className=\"absolute inset-y-0 right-0 flex items-center px-4 pointer-events-none text-gray-500\">\n                                        <span className=\"material-symbols-outlined\">expand_more</span>\n                                    </div>\n                                </div>\n                            </div>\n                        )}\n\n                        {/* End Date */}\n                        {isRecurring && (\n                            <div className=\"animate-fade-in-down delay-75\">\n                                <label className=\"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2\">Fecha de Finalización (Opcional)</label>\n                                <div className=\"relative group\">\n                                    <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n                                        <span className=\"material-symbols-outlined text-gray-400 group-focus-within:text-primary transition-colors\">event_busy</span>\n                                    </div>\n                                    <input\n                                        type=\"date\"\n                                        value={endDate}\n                                        onChange={(e) => setEndDate(e.target.value)}\n                                        min={date} // Cannot end before start\n                                        className=\"w-full pl-10 pr-4 py-3 bg-gray-50 dark:bg-[#252b36] border border-gray-200 dark:border-gray-700/50 rounded-xl focus:ring-2 focus:ring-primary/20 focus:border-primary focus:bg-white dark:focus:bg-[#252b36] transition-all outline-none font-medium text-gray-700 dark:text-white placeholder-gray-400\"\n                                    />\n                                    {endDate && (\n                                        <button\n                                            type=\"button\"\n                                            onClick={() => setEndDate('')}\n                                            className=\"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-danger transition-colors\"\n                                            title=\"Limpiar fecha\"\n                                        >\n                                            <span className=\"material-symbols-outlined text-[18px]\">close</span>\n                                        </button>\n                                    )}\n                                </div>\n                            </div>\n                        )}\n\n                        {/* Footer Buttons */}\n                        <div className=\"flex gap-4 mt-4 pt-4 border-t border-gray-100 dark:border-white/5\">\n                            <button\n                                type=\"button\"\n                                onClick={finalOnClose}\n                                className=\"flex-1 py-3.5 rounded-xl border border-gray-200 dark:border-white/10 text-gray-600 dark:text-gray-300 font-bold hover:bg-gray-50 dark:hover:bg-white/5 transition-all\"\n                            >\n                                Cancelar\n                            </button>\n                            <button\n                                type=\"submit\"\n                                className=\"flex-[2] py-3.5 rounded-xl bg-primary hover:bg-primary-hover text-white font-bold shadow-lg shadow-primary/30 transform hover:-translate-y-0.5 transition-all flex items-center justify-center gap-2\"\n                            >\n                                <span className=\"material-symbols-outlined\">save</span>\n                                Guardar Transacción\n                            </button>\n                        </div>\n\n                    </form>\n                </div>\n            </div>\n        </div>\n    );\n};\n"],"names":[],"mappings":"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"}}]
}