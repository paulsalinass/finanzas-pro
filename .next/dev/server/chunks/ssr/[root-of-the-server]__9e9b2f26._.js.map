{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/grupo/OneDrive/Documentos/Apps/finanzas-pro/utils/supabase/client.ts"],"sourcesContent":["import { createBrowserClient } from '@supabase/ssr'\r\n\r\nexport function createClient() {\r\n    return createBrowserClient(\r\n        process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n        process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\r\n    )\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AAAA;;AAEO,SAAS;IACZ,OAAO,IAAA,iMAAmB;AAI9B"}},
    {"offset": {"line": 42, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/grupo/OneDrive/Documentos/Apps/finanzas-pro/context/FinanceContext.tsx"],"sourcesContent":["\n\"use client\";\n\nimport React, { createContext, useContext, useState, useEffect, ReactNode } from 'react';\nimport { createClient } from '../utils/supabase/client';\nimport { Transaction, Account, Budget, Commitment, RecurringRule, Ledger } from '../types';\nimport { useRouter } from 'next/navigation';\n\n// Database types mapping could be strictly done here, but for now we map manually\n// to match the specific \"Ledger\" vs \"Book\" terminology change requested by user logic vs DB logic.\n// The user \"Ledger\" in UI maps to \"Book\" in DB.\n\ninterface FinanceContextType {\n  transactions: Transaction[];\n  accounts: Account[];\n  budgets: Budget[];\n  commitments: Commitment[];\n  recurringRules: RecurringRule[];\n  ledgers: Ledger[];\n\n  // Actions\n  addTransaction: (t: Omit<Transaction, 'id'>) => Promise<void>;\n  deleteTransaction: (id: string) => Promise<void>;\n  addAccount: (a: Omit<Account, 'id'>) => Promise<void>;\n  addCommitment: (c: Omit<Commitment, 'id'>) => Promise<void>;\n  toggleCommitmentStatus: (id: string, currentStatus: string) => Promise<void>; // Updated signature\n  toggleRuleStatus: (id: string) => void;\n  activateLedger: (id: string) => void;\n\n  totalBalance: number;\n  isDarkMode: boolean;\n  toggleTheme: () => void;\n  isLoading: boolean;\n  activeBookId: string | null;\n}\n\nconst FinanceContext = createContext<FinanceContextType | undefined>(undefined);\n\nexport const FinanceProvider: React.FC<{ children: ReactNode }> = ({ children }) => {\n  const supabase = createClient();\n  const router = useRouter();\n\n  // State\n  const [activeBookId, setActiveBookId] = useState<string | null>(null);\n  const [transactions, setTransactions] = useState<Transaction[]>([]);\n  const [accounts, setAccounts] = useState<Account[]>([]);\n  const [budgets, setBudgets] = useState<Budget[]>([]);\n  const [commitments, setCommitments] = useState<Commitment[]>([]);\n  const [recurringRules, setRecurringRules] = useState<RecurringRule[]>([]); // Migration TODO: Link to commitments?\n  const [ledgers, setLedgers] = useState<Ledger[]>([]); // These are 'books' now\n\n  const [isLoading, setIsLoading] = useState(true);\n  const [isDarkMode, setIsDarkMode] = useState(false);\n\n  // Theme Logic\n  const toggleTheme = () => {\n    setIsDarkMode(prev => {\n      const newMode = !prev;\n      if (typeof window !== 'undefined') {\n        const root = window.document.documentElement;\n        if (newMode) root.classList.add('dark');\n        else root.classList.remove('dark');\n      }\n      return newMode;\n    });\n  };\n\n  // Initial Load: Auth & Books\n  useEffect(() => {\n    const init = async () => {\n      setIsLoading(true);\n      const { data: { user } } = await supabase.auth.getUser();\n\n      if (!user) {\n        // Allow public mock view OR redirect? \n        // For now, let's keep loading false so UI shows \"empty\" or redirects in middleware\n        setIsLoading(false);\n        return;\n      }\n\n      // Fetch Books (mapped to Ledgers in UI)\n      const { data: books, error } = await supabase.from('books').select('*');\n\n      if (books && books.length > 0) {\n        // Map DB Books to UI Ledgers\n        const mappedLedgers: Ledger[] = books.map(b => ({\n          id: b.id,\n          name: b.name,\n          description: '', // TODO: Add to DB?\n          balance: 0, // Calculated later\n          isActive: false,\n          isArchived: false,\n          lastUpdate: b.created_at,\n          icon: 'account_balance_wallet',\n          color: 'blue', // Default\n          type: 'PERSONAL',\n          members: []\n        }));\n\n        setLedgers(mappedLedgers);\n\n        // Activate first book or saved preference\n        if (mappedLedgers.length > 0) {\n          handleChangeActiveBook(mappedLedgers[0].id);\n        }\n      } else {\n        // Create Default Book if none exists\n        await createDefaultBook(user.id);\n      }\n      setIsLoading(false);\n    };\n\n    init();\n  }, []);\n\n  const createDefaultBook = async (userId: string) => {\n    const { data, error } = await supabase.from('books').insert({\n      name: 'Personal',\n      user_id: userId\n    }).select().single();\n\n    if (data) {\n      const newLedger: Ledger = {\n        id: data.id,\n        name: data.name,\n        description: 'Mi primer libro contable',\n        balance: 0,\n        isActive: true,\n        isArchived: false,\n        lastUpdate: new Date().toISOString(),\n        icon: 'person',\n        color: 'blue',\n        type: 'PERSONAL',\n        members: []\n      };\n      setLedgers([newLedger]);\n      handleChangeActiveBook(data.id);\n    }\n  };\n\n  const handleChangeActiveBook = async (bookId: string) => {\n    setActiveBookId(bookId);\n    setLedgers(prev => prev.map(l => ({ ...l, isActive: l.id === bookId })));\n\n    // Fetch Data for this Book\n    await Promise.all([\n      fetchAccounts(bookId),\n      fetchTransactions(bookId),\n      fetchCommitments(bookId)\n    ]);\n  };\n\n  const fetchAccounts = async (bookId: string) => {\n    const { data } = await supabase.from('accounts').select('*').eq('book_id', bookId);\n    if (data) {\n      setAccounts(data.map(a => ({\n        ...a,\n        // Ensure types match UI expectation\n        type: a.type as any\n      })));\n    }\n  };\n\n  const fetchTransactions = async (bookId: string) => {\n    const { data } = await supabase.from('transactions').select('*').eq('book_id', bookId).order('occurred_at', { ascending: false });\n    if (data) {\n      setTransactions(data.map(t => ({\n        id: t.id,\n        amount: t.amount,\n        type: t.type as any,\n        category: 'Uncategorized', // TODO: Fetch category name join\n        category_id: t.category_id,\n        account: 'Unknown', // TODO: Map account ID to Name\n        account_id: t.account_id,\n        description: t.description || '',\n        date: t.occurred_at,\n        icon: 'attach_money' // Default\n      })));\n    }\n  };\n\n  const fetchCommitments = async (bookId: string) => {\n    const { data } = await supabase.from('commitments').select('*').eq('book_id', bookId);\n    if (data) {\n      setCommitments(data.map(c => ({\n        id: c.id,\n        name: c.title,\n        amount: c.amount,\n        frequency: c.frequency as any,\n        nextDueDate: c.next_due_date,\n        status: c.status as any\n      })));\n    }\n  };\n\n  // ACTIONS\n  const addTransaction = async (t: Omit<Transaction, 'id'>) => {\n    if (!activeBookId) return;\n\n    // Find account ID by name (current UI passes name)\n    // In future UI should pass ID. For now, matching by name:\n    const account = accounts.find(a => a.name === t.account);\n    const accountId = account?.id; // Fallback?\n\n    if (!accountId) {\n      console.error(\"Account not found for transaction\");\n      return;\n    }\n\n    const { data, error } = await supabase.from('transactions').insert({\n      book_id: activeBookId,\n      account_id: accountId,\n      type: t.type,\n      amount: t.amount,\n      description: t.description,\n      occurred_at: t.date,\n      // category_id: ... needs mapping\n    }).select().single();\n\n    if (data) {\n      // UI Optimistic Update or Refetch\n      fetchTransactions(activeBookId);\n      fetchAccounts(activeBookId); // Update balances\n    }\n  };\n\n  const addAccount = async (a: Omit<Account, 'id'>) => {\n    if (!activeBookId) return;\n    const { error } = await supabase.from('accounts').insert({\n      book_id: activeBookId,\n      name: a.name,\n      type: a.type,\n      balance: a.balance,\n      // map other fields\n    });\n    if (!error) fetchAccounts(activeBookId);\n  };\n\n  const addCommitment = async (c: Omit<Commitment, 'id'>) => {\n    if (!activeBookId) return;\n    // implementation...\n  };\n\n  const deleteTransaction = async (id: string) => {\n    await supabase.from('transactions').delete().eq('id', id);\n    if (activeBookId) {\n      fetchTransactions(activeBookId);\n      fetchAccounts(activeBookId);\n    }\n  };\n\n  const toggleCommitmentStatus = async (id: string, currentStatus: string) => {\n    // impl\n  };\n\n  const toggleRuleStatus = (id: string) => {\n    // impl\n  };\n\n  const activateLedger = (id: string) => {\n    handleChangeActiveBook(id);\n  };\n\n  const totalBalance = accounts.reduce((sum, acc) => sum + acc.balance, 0);\n\n  return (\n    <FinanceContext.Provider value={{\n      transactions, accounts, budgets, commitments, recurringRules, ledgers,\n      addTransaction, deleteTransaction, addAccount, addCommitment,\n      toggleCommitmentStatus, toggleRuleStatus, activateLedger, totalBalance,\n      isDarkMode, toggleTheme, isLoading, activeBookId\n    }}>\n      {children}\n    </FinanceContext.Provider>\n  );\n};\n\nexport const useFinance = () => {\n  const context = useContext(FinanceContext);\n  if (!context) throw new Error('useFinance must be used within a FinanceProvider');\n  return context;\n};\n"],"names":[],"mappings":"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"}}]
}